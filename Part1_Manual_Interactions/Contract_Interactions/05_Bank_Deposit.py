# 2023 Console Cowboys Python Smart Contract Hacking Course
# @author Olie Brown @ficti0n
# http://cclabs.io 
from web3 import Web3

#Make Connection To local Ganache Blockchain
GANACHE = 'http://127.0.0.1:7545'
web3 = Web3(Web3.HTTPProvider(GANACHE))

#Make Connection to Target Contract
target_address = web3.toChecksumAddress("ADD ADDRESS FROM REMIX")
target_abi = '''ADD ABI FROM REMIX'''
target = web3.eth.contract(address=target_address, abi=target_abi)
print(f'Connected: {web3.isConnected()}')


#Transact with contract depositing eth
#-----------------------------------------------------------------------
second_account = "ADD ADDRESS"
second_account_private_key = "ADD PRIVATE KEY"

#Set Default Account to use (2)
web3.eth.default_account = web3.eth.accounts[1]

#Pull balance from contract with call
print(target.functions.getBalance().call())

depositMoney = target.functions.deposit().buildTransaction({
                            'nonce': web3.eth.getTransactionCount(second_account),
                            'from': second_account,
                            'value': web3.toWei(3, 'ether'),
                            'gas': 3000000,
                            'gasPrice': web3.toWei('50', 'gwei')
    })

signed_deposit = web3.eth.account.signTransaction(depositMoney, second_account_private_key)
transaction_hash = web3.eth.sendRawTransaction(signed_deposit.rawTransaction)

#-------------------------------------------------------------------------------------------
#Get Transaction hash and new Balance after Deposit
print(web3.toHex(transaction_hash))
print(target.functions.getBalance().call())
